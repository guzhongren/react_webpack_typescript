// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/Deferred ../../config ../../tasks/GeometryService ../Polyline ../Polygon ./webMercatorUtils ./spatialReferenceUtils ./jsonUtils".split(" "),function(h,H,I,J,m,z,y,C,K){function v(a,c){return Math.ceil((a-c)/(2*c))}function D(a,c){var b=a.paths||a.rings,d,f,g=b.length,u;for(d=0;d<g;d++)for(u=b[d].length,f=0;f<u;f++){var k=a.getPoint(d,f);a.setPoint(d,f,k.clone().offset(c,0))}return a}function w(a,c){if(!(a instanceof m||a instanceof z))throw console.error("straightLineDensify: the input geometry is neither polyline nor polygon"),
Error("straightLineDensify: the input geometry is neither polyline nor polygon");var b=a instanceof m,d=[],f;h.forEach(b?a.paths:a.rings,function(a){d.push(f=[]);f.push([a[0][0],a[0][1]]);var b,k,e,l,g,p,h,n,m,q,t,r;for(g=0;g<a.length-1;g++){b=a[g][0];k=a[g][1];e=a[g+1][0];l=a[g+1][1];h=Math.sqrt((e-b)*(e-b)+(l-k)*(l-k));n=(l-k)/h;m=(e-b)/h;q=h/c;if(1<q){for(p=1;p<=q-1;p++)r=p*c,t=m*r+b,r=n*r+k,f.push([t,r]);p=(h+Math.floor(q-1)*c)/2;t=m*p+b;r=n*p+k;f.push([t,r])}f.push([e,l])}});return b?new m({paths:d,
spatialReference:a.spatialReference}):new z({rings:d,spatialReference:a.spatialReference})}function E(a,c,b){c&&(a=w(a,1E6),a=y.webMercatorToGeographic(a,!0));b&&(a=D(a,b));return a}function F(a,c,b){var d=a.x||a[0],f;d>c?(f=v(d,c),a.x?a=a.clone().offset(-2*f*c,0):a[0]=d+-2*f*c):d<b&&(f=v(d,b),a.x?a=a.clone().offset(-2*f*b,0):a[0]=d+-2*f*b);return a}function L(a,c){var b=-1;h.forEach(c.cutIndexes,function(d,f){var g=c.geometries[f];h.forEach(g.rings||g.paths,function(a,d){h.some(a,function(b){if(!(180>
b[0])){b=0;var c,f=a.length,e;for(c=0;c<f;c++)e=a[c][0],b=e>b?e:b;b=Number(b.toFixed(9));b=-360*v(b,180);f=a.length;for(c=0;c<f;c++)e=g.getPoint(d,c),g.setPoint(d,c,e.clone().offset(b,0))}return!0})});d===b?g.rings?h.forEach(g.rings,function(b){a[d]=a[d].addRing(b)}):h.forEach(g.paths,function(b){a[d]=a[d].addPath(b)}):(b=d,a[d]=g)});return a}function x(a){for(var c=[],b=0,d=0,f=Math.min,g=Math.max,h=0;h<a.length;h++){for(var k=a[h],e=null,l=0;l<k.length;l++)e=k[l],c.push(e),0===l?d=b=e[0]:(b=f(b,
e[0]),d=g(d,e[0]));e&&c.push([(b+d)/2,0])}return c}var B;return{_straightLineDensify:w,normalizeCentralMeridian:function(a,c){var b=new H;c||(B||(B=new J({url:I.geometryServiceUrl})),c=B);var d=[],f=[],g,u,k,e,l,A,p,w,n=0;h.forEach(a,function(a){if(a)if(g||(g=a.spatialReference,u=C.getInfo(g),e=(k=g.isWebMercator)?2.0037508342788905E7:180,l=k?-2.0037508342788905E7:-180,A=k?102100:4326,p=new m({paths:[[[e,l],[e,e]]],spatialReference:{wkid:A}}),w=new m({paths:[[[l,l],[l,e]]],spatialReference:{wkid:A}})),
u){var b=K.fromJSON(a.toJSON()),c=a.extent;"point"===a.type?d.push(F(b,e,l)):"multipoint"===a.type?(b.points=h.map(b.points,function(a){return F(a,e,l)}),d.push(b)):"extent"===a.type?(b=c.clone()._normalize(null,null,u),d.push(b.rings?new z(b):b)):c?(a=2*v(c.xmin,l)*e,b=0===a?b:D(b,a),c=c.clone().offset(a,0),c.intersects(p)&&c.xmax!==e?(n=c.xmax>n?c.xmax:n,b=E(b,k),f.push(b),d.push("cut")):c.intersects(w)&&c.xmin!==l?(n=2*c.xmax*e>n?2*c.xmax*e:n,b=E(b,k,360),f.push(b),d.push("cut")):d.push(b)):d.push(b)}else d.push(a);
else d.push(a)});for(var x=new m,q=v(n,e),t=-90,r=q;0<q;){var G=-180+360*q;x.addPath([[G,t],[G,-1*t]]);t*=-1;q--}0<f.length&&0<r?c?c.cut(f,x).then(function(e){f=L(f,e);var g=[];h.forEach(d,function(b,c){"cut"===b&&(b=f.shift(),a[c].rings&&1<a[c].rings.length&&b.rings.length>=a[c].rings.length?(d[c]="simplify",g.push(b)):d[c]=!0===k?y.geographicToWebMercator(b):b)});0<g.length?c.simplify(g).then(function(a){h.forEach(d,function(b,c){"simplify"===b&&(d[c]=!0===k?y.geographicToWebMercator(a.shift()):
a.shift())});b.resolve(d)}).otherwise(function(a){b.reject(a)}):b.resolve(d)}).otherwise(function(a){b.reject(a)}):b.reject(Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing.")):(h.forEach(d,function(a,b){"cut"===a&&(a=f.shift(),d[b]=!0===k?y.geographicToWebMercator(a):a)}),b.resolve(d));return b.promise},getDenormalizedExtent:function(a){if(!a)return null;var c=a.extent;if(!c)return null;var b=a.spatialReference&&C.getInfo(a.spatialReference);if(!b)return c;var d=
b.valid[0],b=b.valid[1],f=c.width,g=c.xmax,h=c.xmin;if("extent"===a.type||0===f||f<=b||f>2*b||g<d||h>b)return c;var k;switch(a.type){case "polygon":if(1<a.rings.length)k=x(a.rings);else return c;break;case "polyline":if(1<a.paths.length)k=x(a.paths);else return c;break;case "multipoint":k=a.points}a=Math.min;for(var d=Math.max,e=c.clone(),l=0;l<k.length;l++){var m=k[l][0];0>m?(m+=b,h=d(m,h)):(m-=b,g=a(m,g))}e.xmin=g;e.xmax=h;return e.width<f?(e.xmin-=b,e.xmax-=b,e):c}}});