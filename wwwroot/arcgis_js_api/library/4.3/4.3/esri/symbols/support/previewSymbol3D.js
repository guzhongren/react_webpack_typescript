// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Logger ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./symbolUtils ./gfxUtils ./renderUtils ./previewUtils".split(" "),function(G,H,I,t,B,r,C,J,z,l){function w(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"Fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=r.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function K(a,c){var b=
c&&c.resource;return(b=b&&b.href)&&"Object"!==c.type?t.resolve(b):a.thumbnail&&a.thumbnail.url?t.resolve(a.thumbnail.url):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?C.fetchStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||D}):t.resolve(D)}function d(a,c){if(!a.material||!a.material.color)return a=Math.min(Math.max(J.defaultThematicColor.r+191.25*c,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),d=0;3>d;d++)b[d]=
Math.min(Math.max(b[d]+191.25*c,0),255);b.push(a.material.color.a);return b}function E(a){return a.outline?w(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function u(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),d="rgba(",m=0;3>m;m++)d+=Math.min(Math.max(b[m]+191.25*c,0),255)+",";d+=a.material.color.a+");";a=a.size?r.pt2px(a.size):.75;return{color:d,width:Math.min(a,80)}}function v(a,c,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,offset:0},
{color:c,offset:1}]}}function L(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&a<b}function M(a,c,b,g){var m=a&&a.type,q="Object"===m,e=[];if("Icon"===m)switch(c){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:d(a,0),stroke:w(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:w(a)});break;case "cross":e.push({shape:{type:"path",
path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:E(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:E(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},
{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:w(a)})}else if(q)switch(c){case "cone":c=d(a,0);a=d(a,-.6);a=v(c,a,g?20:b);b=l.getConeShapes(b,g);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":g=d(a,0);a=d(a,-.6);a=v(g,a,b);b=l.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:g});break;case "cube":b=l.getCubeShapes(b,g);e.push({shape:b[0],fill:d(a,0)});e.push({shape:b[1],fill:d(a,-.3)});e.push({shape:b[2],fill:d(a,
-.5)});break;case "cylinder":c=d(a,0);m=d(a,-.6);c=v(c,m,g?20:b);b=l.getCylinderShapes(b,g);e.push({shape:b[0],fill:c});e.push({shape:b[1],fill:c});e.push({shape:b[2],fill:d(a,0)});break;case "diamond":b=l.getDiamondShapes(b);e.push({shape:b[0],fill:d(a,-.3)});e.push({shape:b[1],fill:d(a,0)});e.push({shape:b[2],fill:d(a,-.3)});e.push({shape:b[3],fill:d(a,-.7)});break;case "sphere":g=d(a,0);a=d(a,-.6);a=v(g,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});
break;case "tetrahedron":b=l.getTetrahedronShapes(b),e.push({shape:b[0],fill:d(a,-.3)}),e.push({shape:b[1],fill:d(a,0)}),e.push({shape:b[2],fill:d(a,-.6)})}return e}function N(a,c){var b=c&&c.size?r.pt2px(c.size):null,d=c&&c.maxSize?r.pt2px(c.maxSize):null,m=c&&c.disableUpsampling,q=a.symbolLayers,e=[],h=0,n=0,f=q.getItemAt(q.length-1),F;f&&"Icon"===f.type&&(F=f.size&&r.pt2px(f.size));q.forEach(function(f,x){var k=f&&f.type,A="Icon"===k,k="Object"===k,g=A?f.size&&r.pt2px(f.size):0,l=b||g?Math.ceil(Math.min(b||
g,d||120)):22;if(A||k){var y=w(f),u=y?y.width:0;if(f&&f.resource&&f.resource.href)x=K(a,f).then(function(a){return z.tintImageWithColor(a,l,f.get("material.color"),m)}).then(function(a){var b=a.width,c=a.height;h=Math.max(h,b+2*u);n=Math.max(n,c+2*u);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),e.unshift(x);else{var y=(y=f.get("resource.primitive"))?y:A?"circle":"sphere",v=l;A&&(v=x<q.length-1?b?g/F*l:l:l);x=c&&"tall"===c.symbolConfig||(k?L(f):!1);h=Math.max(h,
x?20:v+2*u);n=Math.max(n,v+2*u);e.unshift(t.resolve(M(f,y,v,x)))}}});return t.eachAlways(e).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&O.warn("error while building swatchInfo!",a.error)});return z.renderSymbol(b,[h,n],{node:c&&c.node,scale:!1})})}function P(a,c){var b=a.symbolLayers,g=[];a=C.isVolumetricSymbol(a);var m=c&&c.size?r.pt2px(c.size):null,q=(c&&c.maxSize?r.pt2px(c.maxSize):null)||80,e=0,h=0,n;b.forEach(function(a,b){var c=a&&a.type,f="Line"===c;if(f||
"Path"===c){var k=u(a,0),p=k&&k.width||0,c=[];f?(0===b&&(n=p),a=Math.min(m||p,q),a=0===b?a:m?p/n*a:a,h=Math.max(h,a),e=Math.max(e,22<a?2*a:40),k.width=a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[e,.5*h]},{command:"E",values:[]}]},stroke:k})):(b=Math.min(m||22,q),k=d(a,0),f=d(a,-.2),a=u(a,-.4),a.width=1,c.push({shape:l.shapes.pathSymbol3DLayer[0],fill:f,stroke:a}),c.push({shape:l.shapes.pathSymbol3DLayer[1],fill:k,stroke:a}),e=h=Math.max(h,b+2));g.push(c)}});
return t.resolve(z.renderSymbol(g,[e,h],{node:c&&c.node,scale:a}))}function Q(a,c){var b="mesh-symbol-3d"===a.type;a=a.symbolLayers;var g=c&&c.size?r.pt2px(c.size):null,m=c&&c.maxSize?r.pt2px(c.maxSize):null,q=g||22,e=[],h=0,n=0;a.forEach(function(a){var c=a.type,f="Fill"===c,g="Line"===c,k="Extrude"===a.type,c=[];if(!b||f){var p=l.shapes.fill[0];f?(g=(f=w(a))&&f.width||0,h=Math.max(h,22+g),n=Math.max(n,22+g),c.push({shape:p,fill:d(a,0),stroke:f})):g?(a=(f=u(a,0))&&f.width||0,p={stroke:f,shape:p},
h=Math.max(h,22+a),n=Math.max(n,22+a),c.push(p)):k&&(p=u(a,-.4),f=d(a,0),a=d(a,-.2),g=Math.min(q,m||120),k=l.getExtrudeSymbolShapes(g),p.width=1,c.push({shape:k[0],fill:a,stroke:p}),c.push({shape:k[1],fill:a,stroke:p}),c.push({shape:k[2],fill:f,stroke:p}),h=Math.max(h,22+2*p.width),n=Math.max(n,22*.7+.5*g+2*p.width));e.push(c)}});return t.resolve(z.renderSymbol(e,[h,n],{node:c&&c.node,scale:!1}))}var D=G.toUrl("esri/images/Legend/legend3dsymboldefault.png"),O=I.getLogger("esri.symbols.support.previewSymbol3D");
H.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return t.reject(new B("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var b=null;switch(a.type){case "point-symbol-3d":b=N(a,c);break;case "line-symbol-3d":b=P(a,c);break;case "polygon-symbol-3d":case "mesh-symbol-3d":b=Q(a,c)}return b?b:t.reject(new B("symbolPreview: swatchInfo3D","symbol not supported."))}});