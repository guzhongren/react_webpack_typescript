// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/accessorSupport/decorators dojo/_base/lang ../request ./Task ./support/FeatureSet ./support/Query ../geometry/Extent ../geometry/support/normalizeUtils".split(" "),function(f,w,t,k,n,h,g,m,u,r,p,v,q){f=function(f){function e(a){a=f.call(this,a)||this;a.gdbVersion=null;a.source=null;return a}t(e,f);e.prototype.execute=function(a,d){var c=this;return q.normalizeCentralMeridian(a.geometry?
[a.geometry]:[]).then(function(b){b=c._encode(g.mixin({},c.parsedUrl.query,{f:"json"},a.toJSON({geometry:b&&b[0]})));if(c.source){var l={source:c.source.toJSON()};b.layer=JSON.stringify(l)}c.gdbVersion&&(b.gdbVersion=c.gdbVersion);b={query:b,callbackParamName:"callback"};if(c.requestOptions||d)b=g.mixin({},c.requestOptions,d,b);return m(c.parsedUrl.path+"/query",b)}).then(this._handleExecuteResponse)};e.prototype.executeRelationshipQuery=function(a,d){a=this._encode(g.mixin({},this.parsedUrl.query,
{f:"json"},a.toJSON()));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);a={query:a,callbackParamName:"callback"};if(this.requestOptions||d)a=g.mixin({},this.requestOptions,d,a);return m(this.parsedUrl.path+"/queryRelatedRecords",a).then(this._handleExecuteRelationshipQueryResponse)};e.prototype.executeForIds=function(a,d){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(b){b=c._encode(g.mixin({},c.parsedUrl.query,{f:"json",returnIdsOnly:!0},a.toJSON({geometry:b&&
b[0]})));if(c.source){var l={source:c.source.toJSON()};b.layer=JSON.stringify(l)}c.gdbVersion&&(b.gdbVersion=c.gdbVersion);b={query:b,callbackParamName:"callback"};if(c.requestOptions||d)b=g.mixin({},c.requestOptions,d,b);return m(c.parsedUrl.path+"/query",b)}).then(this._handleExecuteForIdsResponse)};e.prototype.executeForCount=function(a,d){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(b){b=c._encode(g.mixin({},c.parsedUrl.query,{f:"json",returnIdsOnly:!0,
returnCountOnly:!0},a.toJSON({geometry:b&&b[0]})));if(c.source){var l={source:c.source.toJSON()};b.layer=JSON.stringify(l)}c.gdbVersion&&(b.gdbVersion=c.gdbVersion);b={query:b,callbackParamName:"callback"};if(c.requestOptions||d)b=g.mixin({},c.requestOptions,d,b);return m(c.parsedUrl.path+"/query",b)}).then(this._handleExecuteForCountResponse)};e.prototype.executeForExtent=function(a,d){var c=this;return q.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(b){b=c._encode(g.mixin({},
c.parsedUrl.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJSON({geometry:b&&b[0]})));if(c.source){var l={source:c.source.toJSON()};b.layer=JSON.stringify(l)}c.gdbVersion&&(b.gdbVersion=c.gdbVersion);b={query:b,callbackParamName:"callback"};if(c.requestOptions||d)b=g.mixin({},c.requestOptions,d,b);return m(c.parsedUrl.path+"/query",b)}).then(this._handleExecuteForExtentResponse)};e.prototype._handleExecuteResponse=function(a){return r.fromJSON(a.data)};e.prototype._handleExecuteRelationshipQueryResponse=
function(a){a=a.data;var d=a.geometryType,c=a.spatialReference,b={};a.relatedRecordGroups.forEach(function(a){var f=r.fromJSON({geometryType:d,spatialReference:c,features:a.relatedRecords});if(null!=a.objectId)b[a.objectId]=f;else for(var e in a)a.hasOwnProperty(e)&&"relatedRecords"!==e&&(b[a[e]]=f)});return b};e.prototype._handleExecuteForIdsResponse=function(a){return a.data.objectIds};e.prototype._handleExecuteForCountResponse=function(a){a=a.data;var d=a.features,c=a.objectIds;if(c)a=c.length;
else{if(d)throw Error("Unable to perform query. Please check your parameters.");a=a.count}return a};e.prototype._handleExecuteForExtentResponse=function(a){a=a.data;if(a.hasOwnProperty("extent"))a.extent=v.fromJSON(a.extent);else{if(a.features)throw Error("Layer does not support extent calculation.");if(a.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");}return a};return e}(h.declared(u));k([h.property()],f.prototype,"gdbVersion",void 0);k([h.property()],f.prototype,
"source",void 0);k([n(0,h.cast(p))],f.prototype,"execute",null);k([n(0,h.cast(p))],f.prototype,"executeForIds",null);k([n(0,h.cast(p))],f.prototype,"executeForCount",null);k([n(0,h.cast(p))],f.prototype,"executeForExtent",null);return f=k([h.subclass("esri.tasks.QueryTask")],f)});