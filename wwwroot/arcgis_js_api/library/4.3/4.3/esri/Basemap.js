// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators dojo/_base/lang ./support/basemapDefinitions ./core/Collection ./core/collectionUtils ./core/Evented ./core/JSONSupport ./core/Loadable ./core/promiseUtils ./core/requireUtils ./core/urlUtils ./core/Logger ./portal/Portal ./portal/PortalItem ./layers/Layer".split(" "),function(t,d,u,f,e,n,v,l,h,w,x,y,p,z,m,A,q,B,C){var D=0,k=l.ofType(C),r=A.getLogger("esri.Basemap");d=g=
function(d){function c(a){a=d.call(this)||this;a.id=null;a.portalItem=null;a.resourceInfo=null;a.thumbnailUrl=null;a.title="Basemap";a.id=Date.now().toString(16)+"-basemap-"+D++;a.baseLayers=new l;a.referenceLayers=new l;var b=function(a){"elevation"===a.type&&r.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a basemap layer and will therefore be ignored.")};a.baseLayers.on("after-add",function(a){return b(a.item)});a.referenceLayers.on("after-add",function(a){return b(a.item)});
return a}u(c,d);c.prototype.initialize=function(){var a=this;this.otherwise(function(b){r.error("#load()","Failed to load basemap (title: '"+a.title+"', id: '"+a.id+"')",b)});this.resourceInfo&&this.read(this.resourceInfo)};Object.defineProperty(c.prototype,"baseLayers",{set:function(a){this._set("baseLayers",h.referenceSetter(a,this._get("baseLayers"),k))},enumerable:!0,configurable:!0});c.prototype.writeBaseLayers=function(a,b,E,c){var d=[];if(!a)return d;c=n.mixin({},c,{layerContainerType:"basemap"});
this.baseLayers.forEach(function(a){if(a.write){var b={};a.write(b,c)&&d.push(b)}});this.referenceLayers.forEach(function(a){if(a.write){var b={isReference:!0};a.write(b,c)&&d.push(b)}});b.baseMapLayers=d};Object.defineProperty(c.prototype,"referenceLayers",{set:function(a){this._set("referenceLayers",h.referenceSetter(a,this._get("referenceLayers"),k))},enumerable:!0,configurable:!0});c.prototype.writeTitle=function(a,b){b.title=a||"Basemap"};c.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());
return this};c.prototype.clone=function(){var a={id:this.id,title:this.title};this.resourceInfo||this.portalItem?(a.portalItem=this.portalItem,a.resourceInfo=this.resourceInfo):(a.baseLayers=this.baseLayers.slice(),a.referenceLayers=this.referenceLayers.slice());return new g(a)};c.prototype.read=function(a,b){!b||"web-scene"!==b.origin&&"web-map"!==b.origin||(this._layerOrigin=b.origin);b&&b.portal&&(this._layerPortal=b.portal);return this.inherited(arguments)};c.prototype.write=function(a,b){a=a||
{};this.inherited(arguments,[a,b]);!this.loaded&&this.resourceInfo&&this.resourceInfo.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.baseMapLayers.map(function(a){a=n.clone(a);a.url&&m.isProtocolRelative(a.url)&&(a.url="https:"+a.url);a.templateUrl&&m.isProtocolRelative(a.templateUrl)&&(a.templateUrl="https:"+a.templateUrl);return a}));return a};c.prototype.toJSON=function(){return this.write(null,{origin:"web-map"})};c.prototype._loadFromSource=function(){var a=this.resourceInfo,b=this.portalItem;
return a?this._loadFromJSON(a):b?this._loadFromItem(b):p.resolve(null)};c.prototype._loadFromJSON=function(a,b){var c=this,d=this.portalItem&&this.portalItem.portal||this._layerPortal||null;return z.when(t,"./portal/support/layersCreator").then(function(e){var f=[];if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){var g={context:{origin:c._layerOrigin||"web-map",layerContainerType:"basemap",url:b,portal:d},defaultLayerType:"DefaultTileLayer"},h=e.populateOperationalLayers(c.baseLayers,a.baseMapLayers.filter(function(a){return!a.isReference}),
g);f.push.apply(f,h);e=e.populateOperationalLayers(c.referenceLayers,a.baseMapLayers.filter(function(a){return a.isReference}),g);f.push.apply(f,e)}return p.eachAlways(f)}).then(function(){})};c.prototype._loadFromItem=function(a){var b=this;return a.load().then(function(a){return a.fetchData()}).then(function(c){var d=m.urlToObject(a.itemUrl);b.resourceInfo=c.baseMap;b.read(b.resourceInfo,{origin:"web-map",portal:a.portal||q.getDefault(),url:d});b.read({title:a.title,thumbnailUrl:a.thumbnailUrl},
{origin:"portal-item",portal:a.portal||q.getDefault(),url:d});return b._loadFromJSON(b.resourceInfo,d)})};c.fromJSON=function(a){return a?new g({resourceInfo:a}):null};c.fromId=function(a){return(a=v[a])?g.fromJSON(a):null};return c}(e.declared(x,w,y));f([e.property({type:k,json:{write:{ignoreOrigin:!0}}}),e.cast(h.castForReferenceSetter)],d.prototype,"baseLayers",null);f([e.writer("baseLayers")],d.prototype,"writeBaseLayers",null);f([e.property({json:{origins:{webScene:{write:!0}}}})],d.prototype,
"id",void 0);f([e.property({type:B})],d.prototype,"portalItem",void 0);f([e.property({type:k}),e.cast(h.castForReferenceSetter)],d.prototype,"referenceLayers",null);f([e.property()],d.prototype,"resourceInfo",void 0);f([e.property()],d.prototype,"thumbnailUrl",void 0);f([e.property()],d.prototype,"title",void 0);f([e.writer("title")],d.prototype,"writeTitle",null);d=g=f([e.subclass("esri.Basemap")],d);var g;return d});