// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../../core/promiseUtils ../../../tasks/support/GenerateRendererParameters ./support/utils ../support/utils".split(" "),function(B,C,p,e,u,c,m){function v(a){if(!(a&&a.layer&&a.field))return e.reject(c.createError("class-breaks:missing-parameters","'layer' and 'field' parameters are required"));var b=p.mixin({},a);b.normalizationType=c.getNormalizationType(b);b.layer=m.createLayerAdapter(b.layer);return b.layer?b.layer.load().then(function(){var a=b.layer,
f=b.field,d=b.minValue,k=b.maxValue,g=null!=d||null!=k,l=b.classificationMethod,q="percent-of-total"===b.normalizationType,r=!1!==b.analyzeData,f=f?a.getField(f):null,n=m.getFieldsList({field:b.field,normalizationField:b.normalizationField});if(n=c.verifyBasicFieldValidity(a,n,"class-breaks:invalid-parameters"))return e.reject(n);if(a=c.verifyNumericField(a,f,"class-breaks:invalid-parameters"))return e.reject(a);if(g)if(r){if(q&&null==b.normalizationTotal)return e.reject(c.createError("class-breaks:missing-parameters",
"'normalizationTotal' is required when 'normalizationType' is 'precent-of-total' and 'minValue', 'maxValue' are specified"))}else{if(null==d||null==k)return e.reject(c.createError("class-breaks:missing-parameters","Both 'minValue' and 'maxValue' are required when 'analyzeData' is false"));if(l&&"equal-interval"!==l)return e.reject(c.createError("class-breaks:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'analyzeData' is false"));if(q&&null==b.normalizationTotal)return e.reject(c.createError("class-breaks:missing-parameters",
"'normalizationTotal' is required when 'normalizationType' is 'precent-of-total' and 'analyzeData' is false"))}else if(!r)return e.reject(c.createError("class-breaks:missing-parameters","Both 'minValue' and 'maxValue' are required when 'analyzeData' is false"));return b}):e.reject(c.createError("class-breaks:invalid-parameters","'layer' must be one of these types: "+w))}function x(a,b){var h=a.layer;b=c.createCBDefn(a,b);var f=c.getSQLFilterForNormalization(a),d=c.getFieldExpr(a,a.normalizationTotal);
a=c.getRangeExpr(d,a.minValue,a.maxValue);d=new u;d.classificationDefinition=b;d.where=c.mergeWhereClauses(f,a);return h.generateRenderer(d)}function t(a,b){var c=b.classBreakInfos,f=c[0].minValue,d=c[c.length-1].maxValue,e="standard-deviation"===a.classificationMethod,g=y,c=c.map(function(a){var b=a.label;a={minValue:a.minValue,maxValue:a.maxValue,label:b};if(e&&b){var c=b.match(g).map(function(a){return+p.trim(a)});2===c.length?(a.minStdDev=c[0],a.maxStdDev=c[1],0>c[0]&&0<c[1]&&(a.hasAvg=!0)):1===
c.length&&(-1<b.indexOf("\x3c")?(a.minStdDev=null,a.maxStdDev=c[0]):-1<b.indexOf("\x3e")&&(a.minStdDev=c[0],a.maxStdDev=null))}return a});return{minValue:f,maxValue:d,classBreakInfos:c,normalizationTotal:b.normalizationTotal}}function z(a,b){var h=a.minValue,f=a.maxValue;if(h>=f)return e.reject(c.createError("class-breaks:invalid-parameters","'minValue' should be less than 'maxValue'"));for(var d=[],k=(f-h)/b,g=0;g<b;g++){var l=h+g*k;d.push({minValue:l,maxValue:l+k})}d[b-1].maxValue=f;return e.resolve({classBreakInfos:d,
normalizationTotal:a.normalizationTotal})}function A(a){var b=a.numClasses||5;return!1!==a.analyzeData?x(a,b).then(function(b){return t(a,b)}):z(a,b).then(function(b){return t(a,b)})}var y=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,w=m.supportedLayerTypes.join(", ");return function(a){return v(a).then(function(a){return A(a)})}});