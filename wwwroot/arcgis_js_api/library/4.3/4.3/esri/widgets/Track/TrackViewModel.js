// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/GeolocationPositioning".split(" "),function(c,h,f,e,d,g){c=function(c){function b(a){a=c.call(this,a)||this;a._watchId=null;a._trackStartingTimeoutId=null;return a}f(b,c);b.prototype.destroy=function(){this._stopWatchingPosition()};Object.defineProperty(b.prototype,"state",{get:function(){return this._geolocationUsable?this.get("view.ready")?this.tracking?
"tracking":null!==this._trackStartingTimeoutId?"waiting":"ready":"disabled":"feature-unsupported"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tracking",{get:function(){return null!==this._watchId},enumerable:!0,configurable:!0});b.prototype.start=function(){"disabled"===this.state||this.tracking||this._startTracking()};b.prototype.stop=function(){"disabled"!==this.state&&this.tracking&&this._stopTracking()};b.prototype._stopWatchingPosition=function(){null!==this._watchId&&
(navigator.geolocation.clearWatch(this._watchId),this._watchId=null);this.notifyChange("tracking")};b.prototype._stopTracking=function(){this._stopWatchingPosition();this._clear()};b.prototype._startTracking=function(){var a=this;this._stopWatchingPosition();var b=navigator.geolocation.watchPosition(function(c){a._watchId=b;a.notifyChange("tracking");a._setPosition(c).then(function(b){a._clearWaitingTimer();a.view.graphics.remove(a.graphic);a.graphic&&(a.graphic=a.graphic.clone(),a.view.graphics.push(a.graphic));
a.emit("track",{position:b})}).otherwise(function(b){a._emitError(b);a._clearWaitingTimer();throw b;})},this._handleWatchPositionError.bind(this),this.geolocationOptions);this._trackStartingTimeoutId=setTimeout(function(){a._trackStartingTimeoutId=null;a.notifyChange("state")},15E3);this.notifyChange("state")};b.prototype._handleWatchPositionError=function(a){this._emitError(a);this._clearWaitingTimer()};b.prototype._clearWaitingTimer=function(){clearTimeout(this._trackStartingTimeoutId);this._trackStartingTimeoutId=
null;this.notifyChange("state")};b.prototype._emitError=function(a){this.emit("track-error",{error:a})};return b}(d.declared(g));e([d.property({dependsOn:["view.ready","tracking"],readOnly:!0})],c.prototype,"state",null);e([d.property({readOnly:!0})],c.prototype,"tracking",null);return c=e([d.subclass("esri.widgets.Track.TrackViewModel")],c)});