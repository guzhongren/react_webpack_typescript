// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/watchUtils ../../../Basemap ../../../core/Collection ../../../core/HandleRegistry ../../../portal/Portal ./LocalBasemapsSource".split(" "),function(b,p,f,d,a,g,h,k,l,m,n){var e=k.ofType(h);b=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._handles=new l;c.basemaps=new e;c.filterFunction=null;c.portal=null;return c}
f(a,b);a.prototype.initialize=function(){var c=this;this._handles.add([g.init(this,["filterFunction","portal.basemapGalleryGroupQuery","portal.user"],function(){return c.refresh()})])};a.prototype.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};Object.defineProperty(a.prototype,"state",{get:function(){return this._get("state")},enumerable:!0,configurable:!0});a.prototype.refresh=function(){var c=this;this._set("state","loading");this._lastPortalBasemapFetch&&
(this._lastPortalBasemapFetch.cancel(),this._lastPortalBasemapFetch=null);var a=this.portal;if(a){var b=!1;this._lastPortalBasemapFetch={cancel:function(){b=!0}};a.load().then(function(){if(!b)return a.fetchBasemaps()}).then(function(a){b||(a=c.filterFunction?a.filter(c.filterFunction):a,c.basemaps.removeAll(),c.basemaps.addMany(a))}).otherwise(function(){b||c.basemaps.removeAll()}).then(function(){b||c._set("state","ready")})}else this.basemaps.removeAll(),this._set("state","ready")};return a}(a.declared(n));
d([a.property({readOnly:!0,type:e})],b.prototype,"basemaps",void 0);d([a.property()],b.prototype,"filterFunction",void 0);d([a.property({type:m})],b.prototype,"portal",void 0);d([a.property({readOnly:!0,value:"loading"})],b.prototype,"state",null);return b=d([a.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],b)});