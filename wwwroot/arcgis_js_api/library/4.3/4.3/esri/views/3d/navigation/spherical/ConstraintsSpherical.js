// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../lib/glMatrix ../../constraints/SceneViewAltitudeConstraint ../../constraints/SceneViewTiltConstraint ../../webgl-engine/lib/Util".split(" "),function(l,g,k,r,q,n,t){var h=r.vec3d,m=h.create();return l.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.ConstraintsSpherical",defaultConstraints:{tilt:new l.Tilt({min:function(){return g.deg2rad(n.MAX_DEFAULT)},max:g.makePiecewiseLinearFunction([[4E3,
g.deg2rad(n.MIN_DEFAULT)],[5E4,g.deg2rad(88)],[6E6,g.deg2rad(88)],[2E7,g.deg2rad(n.MAX_DEFAULT)]])}),altitude:new l.Altitude({min:function(){return q.MIN_DEFAULT},max:function(){return q.MAX_DEFAULT}}),collision:new l.Collision},initialize:function(){this.captainNemoAltitudeThreshold=2E4;this.captainNemoElevationThreshold=-500},limitAltitude:function(a,b,e,d){h.scale(e,a/d,m);h.subtract(b,m,m);var c=this.renderCoordsHelper.getAltitude(m),g=this.constraints.altitude.apply(this,c);if(1E-6<Math.abs(c-
g)){var f=h.length(b);b=h.dot(e,b)/(f*d);if(.9999<Math.abs(b))return a+(g-c);c=g+k.earthRadius;a=-2*f*b;f=a*a-4*(-(c*c)+f*f);if(0>f)return this.minPoiDist;f=Math.sqrt(f);return f<a?(a-f)/2:(f-a)/2}return a},limitTiltByAltitudeConstraints:function(a,b,e,d){b=h.length(b);var c=b*b,l=e*e,f=Math.sqrt(c+l-2*b*e*Math.cos(Math.PI-a))-k.earthRadius,m=this.constraints.altitude.min(),n=this.constraints.altitude.max(),p;(void 0===d||0<d)&&f<m?p=m:(void 0===d||0>d)&&f>n&&(p=n);void 0!==p&&(a=p+k.earthRadius,
a=Math.PI-g.acos((-(a*a)+c+l)/(2*b*e)));return a},distanceToSilhouette:function(a,b,e,d,c){c||(c={maxFarNearRatio:0,distance:0});a=h.dot(a.eye,a.eye);b=k.earthRadius*k.earthRadius;c.maxFarNearRatio=this.maxFarNearRatio;this.isNemoMode(a,d)?(d=k.earthRadius+d,c.distance=Math.sqrt(a-d*d)):a>b?(c.maxFarNearRatio=g.clamp(2E4-(Math.log(Math.sqrt(a)-k.earthRadius)-7.983)/9.011*19E3,1E3,2E4),c.distance=Math.sqrt(a-b)):c.distance=this.maxFarNearRatio*this.minNearDistance;c.distance*=1.2;return c},isNemoMode:function(a,
b){var e=k.earthRadius+this.captainNemoAltitudeThreshold;return a<e*e&&b<this.captainNemoElevationThreshold},intersectManifold:function(a,b,e,d){return t.raySphereClosestPositive(a,b,k.earthRadius+e,d)},getFallbackCenterAlongViewDirection:function(a,b,e){var d=h.dot(a,a),c=k.earthRadius*k.earthRadius,d=d>c?Math.sqrt(d-c)/3:1;h.subtract(b,a,e);h.scale(e,d/h.length(e),e);h.add(e,a)}})});