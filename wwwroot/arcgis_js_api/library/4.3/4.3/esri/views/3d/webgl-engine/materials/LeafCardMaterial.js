// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/LeafCardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCard"\x3e\r\n\t\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $normal;\r\n\tattribute vec4 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tuniform float trafoScale;\r\n\tvarying vec3 vpos;\r\n\r\n\tvec2 rotate(vec2 pos, float angle) {\r\n\t\tfloat c \x3d cos(angle);\r\n\t\tfloat s \x3d sin(angle);\r\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n\t}\r\n\r\n\tvoid main(void) {\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0.xy);\r\n\t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w *trafoScale;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w *trafoScale;;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tambientLeaf \x3d normal.w;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal.xyz, 1.0)).xyz);\r\n\t}\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLeafCard"\x3e\r\n\x3c![CDATA[\r\n\tprecision mediump float;\r\n\r\n\tuniform vec3 camPos;\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec4 lightSpecular;\r\n\tuniform vec3 lightDirection;\r\n\r\n\tuniform vec3 ambient;\r\n\tuniform vec3 diffuse;\r\n\tuniform vec3 specular;\r\n\tuniform float shininess;\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tvarying vec3 vpos;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\tvec3 a \x3d ambient * lightAmbient.rgb * lightAmbient.w;\r\n\t\tvec3 d \x3d diffuse * lightDiffuse.rgb * lightDiffuse.w * clamp(dot(vnormal, lightDirection), .0, 1.0);\r\n\r\n\t\tvec3 reflDir \x3d normalize(reflect(vpos - camPos, vnormal));\r\n\t\tfloat specDot \x3d max(dot(reflDir, lightDirection), .001);\r\n\t\tvec3 s \x3d specular * lightSpecular.rgb * lightSpecular.w * pow(specDot, shininess);\r\n\r\n\t\tgl_FragColor \x3d vec4(ambientLeaf * texColor.rgb * (a + d) + s, texColor.a);\r\n\r\n\t\t//gl_FragColor \x3d vec4(ambient,1.0);\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCardDepth"\x3e\x3c![CDATA[\r\n   \tuniform mat4 proj;\r\n   \tuniform mat4 view;\r\n   \tuniform mat4 model;\r\n   \tuniform vec2 nearFar;\r\n\r\n   \tattribute vec3 $position;\r\n   \tattribute vec4 $uv0;\r\n\r\n   \tuniform float trafoScale;\r\n\r\n   \tvarying vec2 vtc;\r\n   \tvarying float depth;\r\n\r\n   \tvec2 rotate(vec2 pos, float angle) {\r\n   \t\tfloat c \x3d cos(angle);\r\n   \t\tfloat s \x3d sin(angle);\r\n   \t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n   \t}\r\n\r\n   \tvoid main(void) {\r\n   \t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n   \t\tvec2 uv01 \x3d floor($uv0.xy);\r\n   \t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n   \t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w*trafoScale;\r\n   \t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w*trafoScale;\r\n   \t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n   \t\tgl_Position \x3d pos4;\r\n   \t\tvtc \x3d uv;\r\n\r\n   \t\tdepth \x3d (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\r\n   \t}\r\n ]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n'}});
define("dojo/text!./LeafCardMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../../../webgl/Util".split(" "),function(Q,x,R,m,M,I,J,S){function v(){K=(9301*K+49297)%233280;return K/233280}var a=m.vec3,H=m.mat4,L=m.mat4d;m=function(y,f,q,E,d,e){x.basicMaterialConstructor(this,e);var g=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:4,type:5126,offset:12,stride:44,
normalized:!1},{name:"uv0",count:4,type:5126,offset:28,stride:44,normalized:!1}],N=S.getStride(g)/4;this.getAmbient=function(){return f};this.getDiffuse=function(){return q};this.getSpecular=function(){return E};this.getShininess=function(){return d};this.dispose=function(){};this.getTextureId=function(){return y};this.getOutputAmount=function(g){var p=0,a;for(a=0;a<g/6;a++)0===a%1&&(p+=6);g=p;for(a=p=0;a<g/6;a++)0===a%1&&(p+=6);return p*N};this.getVertexBufferLayout=function(){return g};this.reduce=
function(a,p){var g=a.position,y=a.normal;a=a.uv0;for(var c=[],b=[],O=[],d=0,e=0;e<g.length/6;e++)if(0===e%p)for(var f=0;6>f;f++)c[d]=g[6*e+f],b[d]=y[6*e+f],O[d]=a[6*e+f],d++;return{position:c,normal:b,uv0:O}};this.fillInterleaved=function(g,p,y,d,c,b){d=x.fill;var e=this.reduce(g.faces.indices,1),e=this.reduce(e,1),f=this.getOutputAmount(g.faces.indices.position.length);R.assert(f===e.position.length*N);var q=e.position,E=e.normal,A=e.uv0,e=g.vertexAttr.position.data,D=g.vertexAttr.normal.data,B=
g.vertexAttr.uv0.data,t=a.create();g=q.length/6;for(var f=b,w=a.createFrom(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=a.createFrom(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=0;m<g;++m){for(var h=a.create(),n=a.create(),k=[100,100,-100,-100],u=a.create(),l=0;6>l;++l){var z=6*m+l,F=3*q[z],G=3*E[z],z=2*A[z];h[0]+=e[F+0];h[1]+=e[F+1];h[2]+=e[F+2];n[0]+=D[G+0];n[1]+=D[G+1];n[2]+=D[G+2];G=B[z+0];z=B[z+1];k[0]=Math.min(k[0],G);k[1]=Math.min(k[1],z);k[2]=Math.max(k[2],G);k[3]=Math.max(k[3],
z);0===l&&a.set3(e[F+0],e[F+1],e[F+2],u)}h[0]/=6;h[1]/=6;h[2]/=6;n[0]/=6;n[1]/=6;n[2]/=6;h[0]+=.1*(2*v()-1);h[1]+=.1*(2*v()-1);h[2]+=.1*(2*v()-1);void 0!==p&&(L.multiplyVec3(p,u,u),L.multiplyVec3(p,h,h),L.multiplyVec3(y,n,n));a.add(h,t,t);a.max(w,h,w);a.min(r,h,r);k[0]+=.01;k[1]+=.01;k[2]-=.01;k[3]-=.01;for(l=0;4>l;l++)k[l]=Math.min(k[l],.99999);l=2*v()*Math.PI;u=1.41*a.dist(u,h);b+=d(h,0,c,b,void 0,3);b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[1];c[b++]=l;c[b++]=u;b+=d(h,0,c,b,void 0,3);
b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[1];c[b++]=l;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[3]+1;c[b++]=l;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[2]+1;c[b++]=k[3]+1;c[b++]=l;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[3]+1;c[b++]=l;c[b++]=u;b+=d(h,0,c,b,void 0,3);b+=d(n,0,c,b,void 0,3);c[b++]=0;c[b++]=k[0];c[b++]=k[1];c[b++]=l;c[b++]=u}t[0]/=g;t[1]/=g;t[2]/=g;p=a.create();
a.add(w,r,p);a.scale(p,.5,p);b=a.create();a.subtract(w,r,b);b[0]=Math.abs(b[0])/2;b[1]=Math.abs(b[1])/2;b[2]=Math.abs(b[2])/2;q=a.create(t);q[1]-=(w[1]-r[1])/3;w=a.create();r=a.create();e=a.create();E=[a.create(),a.create(),a.create(),a.create()];t=[0,0,0,0];A=H.create();for(m=0;m<g;++m){a.set3(c[f],c[f+1],c[f+2],e);a.subtract(e,q,w);a.normalize(w,w);r=a.subtract(e,p,r);a.normalize(r,r);B=Math.abs(a.dot(r,[1,0,0]));l=Math.abs(a.dot(r,[0,1,0]));D=Math.abs(a.dot(r,[0,0,1]));B=B*Math.abs(p[0]-e[0])/
b[0];B+=l*Math.abs(p[1]-e[1])/b[1];B+=D*Math.abs(p[2]-e[2])/b[2];for(l=0;4>l;l++)H.identity(A),H.rotate(A,.8*(2*v()-1),[0,1,0],A),H.rotate(A,.8*(2*v()-1),[1,0,0],A),H.multiplyVec3(A,w,E[l]),t[l]=.5+.5*B-.2*(2*v()-1);D=.8+.3*(2*v()-1);for(l=0;6>l;++l){var C;switch(l){case 0:C=0;break;case 1:C=1;break;case 2:C=2;break;case 3:C=2;break;case 4:C=3;break;case 5:C=0}f+=3;f+=d(E[C],0,c,f,y,3);c[f++]=t[C];f+=3;c[f++]*=D}}};this.intersect=function(){};this.getGLMaterials=function(){return{color:T,depthShadowMap:U,
normal:void 0,depth:P,highlight:void 0}};this.getAllTextureIds=function(){return[y]}};var T=function(a,f,q){x.basicGLMaterialConstructor(this,a);var y=M.TRANSPARENT_MATERIAL,d=f.get("leafCard");x.singleTextureGLMaterialConstructor(this,q,{textureId:a.getTextureId()});this.beginSlot=function(a){return y===a};this.getProgram=function(){return d};var e=a.getAmbient(),g=a.getDiffuse(),m=a.getSpecular(),v=a.getShininess();this.bind=function(a,f){a.bindProgram(d);this.bindTexture(a,d);d.setUniform3fv("ambient",
e);d.setUniform3fv("diffuse",g);d.setUniform3fv("specular",m);d.setUniform1f("shininess",v);d.setUniform1f("trafoScale",1);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,g){x.bindView(g.origin,g.view,d);x.bindCamPos(g.origin,g.viewInvTransp,d)};this.bindInstance=function(a,g){d.setUniformMatrix4fv("model",g.transformation);d.setUniformMatrix4fv("modelNormal",g.transformationNormal);a=g.transformation;d.setUniform1f("trafoScale",(Math.sqrt(a[0]*
a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},P=function(a,f,q,m){x.basicGLMaterialConstructor(this,a);var d=M.TRANSPARENT_MATERIAL,e=null==m?f.get("leafCardDepth"):f.get("leafCardDepthShadowMap");x.singleTextureGLMaterialConstructor(this,q,{textureId:a.getTextureId()});this.beginSlot=function(a){return d===a};this.getProgram=function(){return e};this.bind=function(a,d){a.bindProgram(e);
this.bindTexture(a,e);e.setUniform2fv("nearFar",d.nearFar)};this.release=function(a){};this.bindView=function(a,d){x.bindView(d.origin,d.view,e)};this.bindInstance=function(a,d){e.setUniformMatrix4fv("model",d.transformation);a=d.transformation;e.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},U=function(a,f,q){P.call(this,a,f,q,!0)};m.loadShaders=
function(a,f,q,m){a._parse(Q);var d=new I(m,a.vertexShaderLeafCard,a.fragmentShaderLeafCard,J.Default3D),e=f.get("fsDepthTextured");f=f.get("fsDepthTexturedShadowMap");e=new I(m,a.vertexShaderLeafCardDepth,e.source,J.Default3D,e.defines);a=new I(m,a.vertexShaderLeafCardDepth,f.source,J.Default3D,f.defines);q.add("leafCard",d);q.add("leafCardDepth",e);q.add("leafCardDepthShadowMap",a)};var K=1234;return m});