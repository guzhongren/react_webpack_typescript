// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/promise/all ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../vectorTiles/SchemaHelper ../../vectorTiles/TileHandler ../../vectorTiles/renderers/Renderer ../../layers/LayerView ./support/LayerViewUpdatingPercentage ../terrain/terrainUtils".split(" "),function(d,v,k,f,l,e,g,h,m,n,p,q,r,t,u){d=function(d){function b(a){a=d.call(this)||
this;a._isUpdating=!1;a.minDataLevel=0;a.maxDataLevel=Infinity;return a}k(b,d);b.prototype.initialize=function(){var a=this,c=u.checkIfTileInfoSupportedForView(this.layer.tileInfo256,this.layer.fullExtent,this.view.spatialReference,this.view.basemapTerrain.manifold),d;if(c){var b={layer:this.layer,error:c},e=void 0;switch(c.name){case "tilingscheme:local-gcs-not-supported":e=new g("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":e=
new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:e=new g("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}this.addResolvingPromise(h.reject(e))}else d=m.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var c=a.view.basemapTerrain.tilingScheme.pixelSize[0];a.schemeHelper=new n(c);if(!a.view.basemapTerrain.tilingScheme.compatibleWith(256===
c?a.layer.tileInfo256:a.layer.tileInfo))return c=new g("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"),h.reject(c)});c=this.layer;c.tileInfo&&0<c.tileInfo.lods.length&&(this.minDataLevel=c.tileInfo.lods[0].level,this.maxDataLevel=c.tileInfo.lods[c.tileInfo.lods.length-1].level);var f,c=this._initializeTileHandler();this.tileHandler=c[0];this.renderer=c[1];this._tileHandlerPromise=f=c[2];this.watch("layer.currentStyleInfo",
function(){var c,d,b;a._tileHandlerPromise.isFulfilled()||a._tileHandlerPromise.cancel("cancel");b=a._initializeTileHandler();c=b[0];d=b[1];b=b[2];a._tileHandlerPromise=f;b.then(function(){var b=a.tileHandler;a.renderer=d;a.tileHandler=c;a.emit("data-changed");b.destroy()})});d=l([d,f]);this.addResolvingPromise(d)};b.prototype.destroy=function(){this.renderer=null;this.tileHandler.destroy();this.tileHandler=null};Object.defineProperty(b.prototype,"isTransparent",{get:function(){return!0},enumerable:!0,
configurable:!0});b.prototype.getTileUrl=function(a,c,b){return this.layer.getTileUrl(a,c,b)};b.prototype.isUpdating=function(){return this._isUpdating};b.prototype._evaluateUpdatingState=function(a){this._isUpdating=!!a;this.notifyChange("updating")};b.prototype._initializeTileHandler=function(){var a=new p(this.layer,function(){},1),c=new q,b=a.start();b.then(function(){c.initialize(a.spriteMosaic,a.glyphMosaic,!1)});return[a,c,b]};return b}(e.declared(r,t));f([e.property()],d.prototype,"view",
void 0);f([e.property()],d.prototype,"layer",void 0);f([e.property({readOnly:!0})],d.prototype,"isTransparent",null);f([e.property()],d.prototype,"updatingPercentageValue",void 0);return d=f([e.subclass("esri.views.3d.layers.VectorTileLayerView3D")],d)});