// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["require","exports","./Geometry","./GeometryUtils"],function(u,x,h,v){var w=function(){return function(c,a,b){this.ratio=c;this.x=a;this.y=b}}();u=function(){function c(a,b,d){this.dz=a;this.yPos=b;this.xPos=d}c.prototype.setExtent=function(a){this.finalRatio=4096/a*(1<<this.dz);var b;b=64/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};c.prototype.reset=function(a){this.type=a;this._prevIsIn=
!1;this.lines=[];this.line=null};c.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new h.Point(a,b);this._firstPt=new h.Point(a,b)};c.prototype.lineTo=function(a,b){var d=this._isIn(a,b),f,g,k,e,c,m;if(d)this._prevIsIn?this._lineTo(a,b,!0):(f=this._prevPt,g=new h.Point(a,b),k=this._intersect(g,f),this._lineTo(k.x,k.y,!0),this._lineTo(g.x,g.y,!0));else{if(this._prevIsIn)g=this._prevPt,f=new h.Point(a,b),k=this._intersect(g,
f),this._lineTo(k.x,k.y,!0);else{var l=this._prevPt;f=new h.Point(a,b);if(!(l.x<=this.xmin&&f.x<=this.xmin||l.x>=this.xmax&&f.x>=this.xmax||l.y<=this.ymin&&f.y<=this.ymin||l.y>=this.ymax&&f.y>=this.ymax)){g=[];if(l.x<this.xmin&&f.x>this.xmin||l.x>this.xmin&&f.x<this.xmin)k=(this.xmin-l.x)/(f.x-l.x),m=l.y+k*(f.y-l.y),m<=this.ymin?c=!1:m>=this.ymax?c=!0:g.push(new w(k,this.xmin,m));if(l.x<this.xmax&&f.x>this.xmax||l.x>this.xmax&&f.x<this.xmax)k=(this.xmax-l.x)/(f.x-l.x),m=l.y+k*(f.y-l.y),m<=this.ymin?
c=!1:m>=this.ymax?c=!0:g.push(new w(k,this.xmax,m));if(l.y<this.ymin&&f.y>this.ymin||l.y>this.ymin&&f.y<this.ymin)k=(this.ymin-l.y)/(f.y-l.y),m=l.x+k*(f.x-l.x),m<=this.xmin?e=!1:m>=this.xmax?e=!0:g.push(new w(k,m,this.ymin));if(l.y<this.ymax&&f.y>this.ymax||l.y>this.ymax&&f.y<this.ymax)k=(this.ymax-l.y)/(f.y-l.y),m=l.x+k*(f.x-l.x),m<=this.xmin?e=!1:m>=this.xmax?e=!0:g.push(new w(k,m,this.ymax));if(0===g.length)e?c?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):c?this._lineTo(this.xmin,
this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<g.length&&g[0].ratio>g[1].ratio)this._lineTo(g[1].x,g[1].y,!0),this._lineTo(g[0].x,g[0].y,!0);else for(k=0;k<g.length;k++)this._lineTo(g[k].x,g[k].y,!0)}}this._lineTo(f.x,f.y,!1)}this._prevIsIn=d;this._prevPt=new h.Point(a,b)};c.prototype.close=function(){var a,b;0<this.line.length&&(a=this._firstPt,b=this._prevPt,a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y),a=this.line,b=a.length,4<=b&&(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&
a[0].y===a[b-2].y)&&(a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y))};c.prototype.result=function(){this._pushLine();if(0===this.lines.length)return null;3===this.type&&y.simplify(this.margin*this.finalRatio,this.lines);return this.lines};c.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};c.prototype._intersect=function(a,b){var d,f;if(b.x>=this.xmin&&b.x<=this.xmax)f=b.y<=this.ymin?this.ymin:this.ymax,d=a.x+(f-a.y)/(b.y-a.y)*(b.x-a.x);else if(b.y>=this.ymin&&
b.y<=this.ymax)d=b.x<=this.xmin?this.xmin:this.xmax,f=a.y+(d-a.x)/(b.x-a.x)*(b.y-a.y);else{f=b.y<=this.ymin?this.ymin:this.ymax;d=b.x<=this.xmin?this.xmin:this.xmax;var g=(d-a.x)/(b.x-a.x),k=(f-a.y)/(b.y-a.y);g<k?f=a.y+g*(b.y-a.y):d=a.x+k*(b.x-a.x)}return new h.Point(d,f)};c.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&this.lines.push(this.line):2===this.type?1<this.line.length&&this.lines.push(this.line):3===this.type&&3<this.line.length&&this.lines.push(this.line));
this.line=[]};c.prototype._moveTo=function(a,b,d){3!==this.type?d&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b))):(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b)),this._is_v=this._is_h=
!1)};c.prototype._lineTo=function(a,b,d){if(3!==this.type)if(d){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(d=this.line[this.line.length-1],d.equals(a,b)))return;this.line.push(new h.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*
this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){d=this.line[this.line.length-1];var f=d.x===a,g=d.y===b;f&&g||(this._is_h&&f?(d.x=a,d.y=b,d=this.line[this.line.length-2],this._is_h=d.x===a,this._is_v=d.y===b):this._is_v&&g?(d.x=a,d.y=b,d=this.line[this.line.length-2],this._is_h=d.x===a,this._is_v=d.y===b):(this.line.push(new h.Point(a,b)),this._is_h=f,this._is_v=g))}else this.line.push(new h.Point(a,b))};return c}();x.TileClipper=u;u=function(){function c(){}
c.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};c.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};c.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var d=this._ratio;this.line.push(new h.Point(Math.round(a*d),Math.round(b*d)))};c.prototype.lineTo=function(a,b){var d=this._ratio;this.line.push(new h.Point(Math.round(a*d),Math.round(b*d)))};c.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};
c.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&y.simplify(64,this.lines);return this.lines};return c}();x.SimpleBuilder=u;var y=function(){function c(){}c.simplify=function(a,b){if(b){var d=-a,f=4096+a,g=-a,k=4096+a;a=[];for(var e=[],z=b.length,m=0;m<z;++m){var l=b[m];if(l&&!(2>l.length))for(var r=l[0],n=void 0,h=l.length,p=1;p<h;++p)n=l[p],r.x===n.x&&(r.x<=d&&(r.y>n.y?(a.push(m),a.push(p),a.push(0),a.push(-1)):
(e.push(m),e.push(p),e.push(0),e.push(-1))),r.x>=f&&(r.y<n.y?(a.push(m),a.push(p),a.push(1),a.push(-1)):(e.push(m),e.push(p),e.push(1),e.push(-1)))),r.y===n.y&&(r.y<=g&&(r.x<n.x?(a.push(m),a.push(p),a.push(2),a.push(-1)):(e.push(m),e.push(p),e.push(2),e.push(-1))),r.y>=k&&(r.x>n.x?(a.push(m),a.push(p),a.push(3),a.push(-1)):(e.push(m),e.push(p),e.push(3),e.push(-1)))),r=n}0!==a.length&&0!==e.length&&(c.fillParent(b,e,a),c.fillParent(b,a,e),d=[],c.calcDeltas(d,e,a),c.calcDeltas(d,a,e),c.addDeltas(d,
b))}};c.fillParent=function(a,b,d){for(var f=d.length,g=b.length,k=0;k<g;k+=4){for(var e=b[k],c=b[k+1],m=b[k+2],l=a[e][c-1],e=a[e][c],c=8092,h=-1,n=0;n<f;n+=4)if(d[n+2]===m){var t=d[n],p=d[n+1],q=a[t][p-1],t=a[t][p];switch(m){case 0:case 1:v.between(l.y,q.y,t.y)&&v.between(e.y,q.y,t.y)&&(q=Math.abs(t.y-q.y),q<c&&(c=q,h=n));break;case 2:case 3:v.between(l.x,q.x,t.x)&&v.between(e.x,q.x,t.x)&&(q=Math.abs(t.x-q.x),q<c&&(c=q,h=n))}}b[k+3]=h}};c.calcDeltas=function(a,b,d){for(var f=b.length,g=0;g<f;g+=
4){var k=c.calcDelta(g,b,d,[]);a.push(b[g]);a.push(b[g+1]);a.push(b[g+2]);a.push(k)}};c.calcDelta=function(a,b,d,f){a=b[a+3];if(-1===a)return 0;var g=f.length;if(1<g&&f[g-2]===a)return 0;f.push(a);return c.calcDelta(a,d,b,f)+1};c.addDeltas=function(a,b){for(var d=a.length,f=0,g=0;g<d;g+=4){var c=a[g+3];c>f&&(f=c)}for(g=0;g<d;g+=4){var e=b[a[g]],h=a[g+1],c=f-a[g+3];switch(a[g+2]){case 0:e[h-1].x-=c;e[h].x-=c;break;case 1:e[h-1].x+=c;e[h].x+=c;break;case 2:e[h-1].y-=c;e[h].y-=c;break;case 3:e[h-1].y+=
c,e[h].y+=c}}a=b.length;for(d=0;d<a;++d)e=b[d],!e||2>e.length||e[e.length-1].x!==e[0].x&&e[e.length-1].y!==e[0].y&&e.push(e[0])};return c}()});