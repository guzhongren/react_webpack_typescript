// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),function(z,A,n,p,v,w,x,y,k){return function(){function f(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._initialized=!1;this._extrudeMat=n.create();this._haloColor=p.create();this._sdfColor=p.create();this._scaleVec=v.create()}f.prototype.render=
function(c,e,a,t,d,g,b,l,f,p,q,r){this._initialized||this._initialize(c);var k=b.getLayoutValue("text-size",a),h=k/24;t=y.degToByte(t);var m=b.getLayoutValue("text-rotation-alignment",a);1===m&&(1!==b.getLayoutValue("symbol-placement",a)||b.hasLayoutProperty("text-rotation-alignment")||(m=0));var u=0===m,m=b.getLayoutValue("text-keep-upright",a)&&u;q=.1*24/k/q;r*=b.getPaintValue("text-opacity",a);this._glyphTextureSize||(this._glyphTextureSize=new Float32Array([l.width/4,l.height/4]));u?n.copy(this._extrudeMat,
f):n.copy(this._extrudeMat,p);this._scaleVec[0]=h;this._scaleVec[1]=h;this._scaleVec[2]=1;n.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);l.bind(c,9729,0);c.bindProgram(this._sdfProgram);if(l=this._getSDFVAO(c,g))c.bindVAO(l),this._sdfProgram.setUniformMatrix4fv("u_transformMatrix",g.tileTransform.transform),this._sdfProgram.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),this._sdfProgram.setUniform2fv("u_normalized_origin",g.tileTransform.displayCoord),this._sdfProgram.setUniform1f("u_depth",
b.z),this._sdfProgram.setUniform2fv("u_mosaicSize",this._glyphTextureSize),this._sdfProgram.setUniform1f("u_mapRotation",t),this._sdfProgram.setUniform1f("u_keepUpright",m?1:0),this._sdfProgram.setUniform1f("u_level",10*a),this._sdfProgram.setUniform1f("u_fadeSpeed",10*d.fadeSpeed),this._sdfProgram.setUniform1f("u_minfadeLevel",10*d.minfadeLevel),this._sdfProgram.setUniform1f("u_maxfadeLevel",10*d.maxfadeLevel),this._sdfProgram.setUniform1f("u_fadeChange",10*(a+d.fadeChange)),this._sdfProgram.setUniform1f("u_opacity",
r),this._sdfProgram.setUniform1i("u_texture",0),d=b.getPaintValue("text-halo-color",a),0<d[3]&&(g=d[3]*r,this._haloColor[0]=g*d[0],this._haloColor[1]=g*d[1],this._haloColor[2]=g*d[2],this._haloColor[3]=g,d=q+b.getPaintValue("text-halo-blur",a)/h/8,h=.75-b.getPaintValue("text-halo-width",a)/h/8,this._sdfProgram.setUniform4fv("u_color",this._haloColor),this._sdfProgram.setUniform1f("u_edgeDistance",h),this._sdfProgram.setUniform1f("u_edgeWidth",d),c.drawElements(4,e.textElementCount,5125,12*e.textElementStart)),
a=b.getPaintValue("text-color",a),0<a[3]&&(b=a[3]*r,this._sdfColor[0]=b*a[0],this._sdfColor[1]=b*a[1],this._sdfColor[2]=b*a[2],this._sdfColor[3]=b,this._sdfProgram.setUniform4fv("u_color",this._sdfColor),this._sdfProgram.setUniform1f("u_edgeDistance",.75),this._sdfProgram.setUniform1f("u_edgeWidth",q),c.drawElements(4,e.textElementCount,5125,12*e.textElementStart)),c.bindVAO()};f.prototype._initialize=function(c){if(this._initialized)return!0;this._sdfProgram=new w(c,k.sdfShaderVS,k.sdfShaderFS,this._attributeLocations);
this._sdfVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};f.prototype._getSDFVAO=function(c,e){if(e.textVertexArrayObject)return e.textVertexArrayObject;var a=e.textVertexBuffer,
f=e.textIndexBuffer;if(!a||!f)return null;e.textVertexArrayObject=new x(c,this._attributeLocations,this._sdfVertexAttributes,{geometry:a},f);return e.textVertexArrayObject};return f}()});