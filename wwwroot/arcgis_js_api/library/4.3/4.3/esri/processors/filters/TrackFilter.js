// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["../../core/declare","dojo/_base/array","dojo/_base/lang","../Filter"],function(g,h,k,l){return g([l],{declaredClass:"esri.processors.filters.TrackFilter",normalizeCtorArgs:function(a){"string"===typeof a&&(a={trackIdField:a});return a},getDefaults:function(){return k.mixin(this.inherited(arguments),{idField:"id",parentField:"parent"})},trackIdField:null,idField:null,parentField:null,run:function(a){if(this.trackIdField&&a){var b=a.removed||[],c=a.added||[],d,e,f;if(b.length)for(e=0,f=b.length;e<
f;e++)d=b[e],this._removeItemFromOutput(d,this.idField);c.length&&this.output.addMany(a.added.map(function(a){a[this.parentField]=a.attributes[this.trackIdField];return a}.bind(this)))}},_getIndexOfItem:function(a,b,c){var d=a[b];return c.findIndex(function(a){return a[b]===d},this)},_removeItemFromOutput:function(a,b){var c=a[b];b=this._getIndexOfItem(a,b,this.output);-1!==b&&this.output.removeAt(b);return{index:b,id:c,parent:a[this.parentField]}},_getItemsByParent:function(a,b){return b.filter(function(b){return b[this.parentField]===
a},this)},_getTracksAffectedByChanges:function(a){a=a||{};var b=a.added||[],c=[],b=b.concat(a.removed||[]);if(b.length)for(var d=0,e=b.length;d<e;d++)a=b[d],-1===h.indexOf(c,a[this.parentField])&&c.push(a[this.parentField]);return c}})});