/*! ArcGIS API for JavaScript 4.3 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["esri/config","esri/request","esri/core/HandleRegistry","esri-playground-js/utils/CurrentState","esri-playground-js/utils/CodeGenerator","dojo/dom","dojo/dom-construct"],function(e,t,n,a,r,l,s){function u(e){f().then(function(t){i(e,"styleName",t.styles);var n=e.statefulObject.watch("styleName",function(n,a,r){r&&(e.statefulObject.set("name",null),o(e,t.groupId,r))});y.add(n,"web-style-symbol-styleName-handler"),e.statefulObject.styleName&&o(e,t.groupId,e.statefulObject.styleName)})}function o(e,t,n){d(t,n).then(function(t){i(e,"name",t)})}function c(e,t){m(t).then(function(t){i(e,"name",t)})}function i(e,t,n){var a=e.config,u=r.getProperty(a,a.className,t);if(u){if(n){var o={type:"String",values:[]};n.forEach(function(e){o.values.push(e),u&&(u.options=o)})}else delete u.options;e.set("config",a);var c=u.domId+"-ID",i=l.byId(c),f=i.parentNode;s.destroy(i);var d;if(n){d=document.createElement("SELECT"),d.className="property-value",d.setAttribute("id",c),d.setAttribute("name",u.name);var m=document.createElement("option");m.innerHTML="select "+u.name,m.className="property-value",m.disabled=!0,m.selected=!0,m.style.background="#ecf0f1",d.appendChild(m),u.options.values.forEach(function(e){var t=document.createElement("option");t.innerHTML=e.name,t.setAttribute("value",e.value),d.appendChild(t)})}else d=document.createElement("input"),d.className="property-value",d.setAttribute("id",c),d.setAttribute("type","text"),d.setAttribute("placeholder","enter "+u.name);f.appendChild(d),e.statefulObject[u.name]&&(d.value=e.statefulObject[u.name]),e.statefulObject.watch(u.name,function(e,t,n){d.value=n}),d.addEventListener("change",function(){e.statefulObject.set(u.name,d.value)},!1),n||(d.value=null,e.statefulObject.set(u.name,null))}}function f(){var n;return t(e.portalUrl+"/sharing/rest/portals/self?f=json").then(function(n){return t(e.portalUrl+"/sharing/rest/community/groups/",{query:{q:n.data.stylesGroupQuery,f:"json"}})}).then(function(a){return n=a.data.results[0].id,t(e.portalUrl+"/sharing/rest/search",{query:{q:"group: "+n,f:"json"}})}).then(function(e){var t=[];return e.data.results.forEach(function(e){var n=e.typeKeywords[0];t.push({name:e.title,value:"3d"===n?e.typeKeywords[1]:n})}),{groupId:n,styles:t}})}function d(n,a){return t(e.portalUrl+"/sharing/rest/search",{query:{q:"group: "+n+" AND typekeywords: "+a,f:"json"}}).then(function(n){return t(e.portalUrl+"/sharing/rest/content/items/"+n.data.results[0].id+"/data?f=json").then(function(e){return e.data.items.map(function(e){return{name:e.name,value:e.name}})})})}function m(e){return t(e+"?f=json").then(function(e){return e.data.items.map(function(e){return{name:e.name,value:e.name}})})}var p={},y=new n,b=function(){y.removeAll();var e=a.getInstance(),t=e.statefulObject.portal.watch("url",function(t,n,a){y.remove("web-style-symbol-styleName-handler"),a?(e.statefulObject.set("styleUrl",null),u(e)):(i(e,"styleName",null),i(e,"name",null))});y.add("web-style-symbol-portal-url-handler",t);var n=e.statefulObject.watch("styleUrl",function(t,n,a){a?(e.statefulObject.portal.set("url",null),c(e,a)):i(e,"name",null)});y.add(n,"web-style-symbol-styleUrl-handler"),e.statefulObject.portal.url||e.statefulObject.styleUrl||e.statefulObject.portal.set("url","https://www.arcgis.com"),e.statefulObject.portal.url&&u(e),e.statefulObject.styleUrl&&c(e,e.statefulObject.styleUrl)};return p.init=b,p});